<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Chatbox OpenRouter (no server)</title>
  <style>
    body { font-family: Arial, sans-serif; background:#0f172a; color:#e2e8f0; margin:0; display:flex; flex-direction:column; height:100vh; }
    .messages { flex:1; overflow:auto; padding:10px; }
    .msg { max-width:80%; margin:6px 0; padding:10px; border-radius:10px; line-height:1.4; }
    .user { background:#f1f5f9; color:#0f172a; margin-left:auto; }
    .assistant { background:#1e293b; }
    form { display:flex; padding:10px; gap:8px; background:#0f172a; }
    textarea { flex:1; resize:none; padding:10px; border-radius:8px; border:none; font-size:14px; }
    button { padding:10px 16px; border:none; border-radius:8px; background:#38bdf8; font-weight:bold; }
  </style>
</head>
<body>
  <div class="messages" id="messages"></div>
  <form id="chatForm">
    <textarea id="input" placeholder="Nhập tin nhắn..." rows="1"></textarea>
    <button type="submit">Gửi</button>
  </form>

  <script type="module">
    const messagesEl = document.getElementById('messages');
    const inputEl = document.getElementById('input');
    const form = document.getElementById('chatForm');

    let history = [];

    function render() {
      messagesEl.innerHTML = '';
      history.forEach(m => {
        const div = document.createElement('div');
        div.className = 'msg ' + (m.role === 'user' ? 'user' : 'assistant');
        div.textContent = m.content;
        messagesEl.appendChild(div);
      });
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    async function sendMessage(text) {
      history.push({ role: 'user', content: text });
      render();

      // gọi API trực tiếp
      const resp = await fetch("https://openrouter.ai/api/v1/chat/completions", {
        method: "POST",
        headers: {
          "Authorization": "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",   // ⚠️ Đặt API key ở đây (không an toàn)
          "Content-Type": "application/json",
          "HTTP-Referer": "<YOUR_SITE_URL>",  // tuỳ chọn
          "X-Title": "<YOUR_SITE_NAME>"       // tuỳ chọn
        },
        body: JSON.stringify({
          model: "deepseek/deepseek-r1-0528:free",
          messages: history
        })
      });

      const data = await resp.json();
      const reply = data.choices?.[0]?.message?.content || "Không có phản hồi.";
      history.push({ role: 'assistant', content: reply });
      render();
    }

    form.addEventListener('submit', e => {
      e.preventDefault();
      const text = inputEl.value.trim();
      if (!text) return;
      inputEl.value = '';
      sendMessage(text);
    });

    // welcome
    history.push({ role: 'assistant', content: 'Xin chào! Hãy hỏi tôi điều gì đó.' });
    render();
  </script>
</body>
</html>
